<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Monitoramento - TCM_FORQUILHA</title>
<style>
    :root { --primary: #2c3e50; --secondary: #34495e; --accent: #3498db; --success: #27ae60; --danger: #e74c3c; --bg: #f4f6f7; --card-bg: #ffffff; --text: #333; }
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: var(--bg); color: var(--text); margin: 0; display: flex; flex-direction: column; min-height: 100vh; }
    .container { width: 95%; max-width: 1400px; margin: 0 auto; padding: 20px 0; }
    
    /* Header & Date Picker */
    header { background-color: var(--card-bg); padding: 15px 0; box-shadow: 0 2px 5px rgba(0,0,0,0.05); margin-bottom: 20px; }
    .header-content { display: flex; justify-content: space-between; align-items: center; padding: 0 20px; flex-wrap: wrap; gap: 10px; }
    h1 { margin: 0; font-size: 1.4rem; color: var(--primary); }
    .date-control { display: flex; align-items: center; gap: 10px; background: var(--bg); padding: 5px 15px; border-radius: 8px; }
    input[type="date"] { padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 1rem; color: var(--primary); outline: none; }
    .btn-nav { background: none; border: none; font-size: 1.2rem; cursor: pointer; color: var(--secondary); padding: 0 10px; }
    .btn-nav:hover { color: var(--accent); }

    /* KPIs */
    .kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; }
    .kpi-card { background: var(--card-bg); padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); text-align: center; border-bottom: 4px solid transparent; }
    .kpi-card .value { display: block; font-size: 2.5rem; font-weight: bold; margin-bottom: 5px; }
    .kpi-card .label { color: #7f8c8d; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; }
    .kpi-online { border-color: var(--success); color: var(--success); }
    .kpi-offline { border-color: var(--danger); color: var(--danger); }
    .kpi-total { border-color: var(--accent); color: var(--accent); }

    /* Tabs */
    .tabs { display: flex; gap: 10px; margin-bottom: 15px; }
    .tab-btn { padding: 10px 20px; border: none; background: #dfe6e9; cursor: pointer; border-radius: 5px; font-weight: 600; color: #636e72; transition: 0.3s; }
    .tab-btn.active { background: var(--accent); color: white; }

    /* Content Area */
    .view-section { display: none; animation: fadeIn 0.3s; }
    .view-section.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

    /* Table (Inativos) */
    .data-table { width: 100%; border-collapse: collapse; background: var(--card-bg); border-radius: 8px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
    .data-table th, .data-table td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #eee; }
    .data-table th { background-color: #f8f9fa; font-weight: 600; color: var(--secondary); }
    .status-badge { padding: 4px 10px; border-radius: 12px; font-size: 0.85rem; font-weight: bold; }
    .bg-danger { background-color: rgba(231, 76, 60, 0.1); color: var(--danger); }
    
    /* Grid (Ativos) */
    .vehicle-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 15px; }
    .vehicle-card { background: var(--card-bg); padding: 15px; border-radius: 8px; border: 1px solid #eee; cursor: pointer; transition: transform 0.2s; position: relative; overflow: hidden; }
    .vehicle-card:hover { transform: translateY(-3px); border-color: var(--success); }
    .vehicle-card::before { content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 4px; background-color: var(--success); }
    .v-prefix { font-size: 1.4rem; font-weight: bold; color: var(--primary); display: block; }
    .v-time { font-size: 0.9rem; color: #7f8c8d; margin-top: 5px; display: block; }

    /* Modal */
    .modal { display: none; position: fixed; z-index: 999; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); }
    .modal-content { background-color: var(--card-bg); margin: 10% auto; padding: 25px; border-radius: 10px; width: 90%; max-width: 500px; position: relative; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
    .close-modal { position: absolute; right: 20px; top: 15px; font-size: 28px; cursor: pointer; color: #aaa; }
    .modal-info p { border-bottom: 1px solid #eee; padding: 10px 0; display: flex; justify-content: space-between; }
    
    .empty-state { text-align: center; padding: 40px; color: #95a5a6; font-style: italic; }
</style>
</head>
<body>

<header>
    <div class="container header-content">
        <div>
            <h1>üìä Dashboard Frota</h1>
            <small style="color: gray;">TCM_FORQUILHA</small>
        </div>
        <div class="date-control">
            <button class="btn-nav" onclick="changeDate(-1)">‚ùÆ</button>
            <input type="date" id="datePicker" value="2025-12-10">
            <button class="btn-nav" onclick="changeDate(1)">‚ùØ</button>
        </div>
    </div>
</header>

<div class="container">
    <div class="kpi-grid">
        <div class="kpi-card kpi-online">
            <span class="value" id="kpi-online">0</span>
            <span class="label">Comunicaram</span>
        </div>
        <div class="kpi-card kpi-offline">
            <span class="value" id="kpi-offline">0</span>
            <span class="label">Sem Comunica√ß√£o</span>
        </div>
        <div class="kpi-card kpi-total">
            <span class="value" id="kpi-total">0</span>
            <span class="label">Total Frota</span>
        </div>
    </div>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('inativos')">Inativos (<span id="count-inativos">0</span>)</button>
        <button class="tab-btn" onclick="switchTab('ativos')">Ativos (<span id="count-ativos">0</span>)</button>
    </div>

    <div id="inativos" class="view-section active">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Status</th>
                    <th>Prefixo</th>
                    <th>√öltima Com. (No dia)</th>
                    <th>A√ß√µes</th>
                </tr>
            </thead>
            <tbody id="lista-inativos">
                </tbody>
        </table>
        <div id="empty-inativos" class="empty-state" style="display:none">Nenhum ve√≠culo inativo nesta data! üéâ</div>
    </div>

    <div id="ativos" class="view-section">
        <div class="vehicle-grid" id="lista-ativos">
            </div>
        <div id="empty-ativos" class="empty-state" style="display:none">Nenhum ve√≠culo comunicou nesta data.</div>
    </div>
</div>

<div id="modalInfo" class="modal">
    <div class="modal-content">
        <span class="close-modal" onclick="closeModal()">&times;</span>
        <h2 id="modalTitle" style="margin-top:0">Detalhes</h2>
        <div class="modal-info" id="modalBody"></div>
    </div>
</div>

<script>
    // --- DADOS INJETADOS PELO PYTHON ---
    const FROTA = ["37502", "37503", "37504", "37505", "37506", "37507", "37508", "37509", "37510", "37513", "37514", "37515", "37516", "37518", "37520", "37522", "37523", "37524", "39005", "39011", "39013", "39018", "39021", "39031", "39034", "39036", "39037", "39038", "39041", "39049", "39053", "39054", "39055", "39059", "39060", "39062", "39064", "39066", "39069", "39072", "39074", "39081", "39082", "39083", "39084", "39086", "39093", "39094", "39095", "39116", "39119", "39121", "39122", "39126", "39130", "39131", "39132", "39133", "39134", "39136", "39142", "39501", "39504", "39507", "39508", "39510", "39511", "39514", "39518", "39531", "39533", "39537", "39538", "39540", "39541", "39546", "39547", "400109", "400123", "400124", "400125", "400129", "400130", "400131", "400132", "400134", "400136", "400137", "400138", "400139", "400140", "400141", "400143", "400144", "400145", "400147", "400149", "400167", "400168", "400169", "400170", "400171", "400172", "400176", "400189", "400196", "400197", "400198", "400205", "400206", "400207", "400208", "400209", "400218"];
    const METADATA = {"37502": {"serie": "67659.0", "versao": "91.13", "eod": "212.0"}, "37503": {"serie": "67421.0", "versao": "91.13", "eod": "212.0"}, "37504": {"serie": "67275.0", "versao": "91.13", "eod": "212.0"}, "37505": {"serie": "66245.0", "versao": "91.13", "eod": "212.0"}, "37506": {"serie": "67688.0", "versao": "91.13", "eod": "212.0"}, "37507": {"serie": "67053.0", "versao": "91.13", "eod": "212.0"}, "37508": {"serie": "67602.0", "versao": "91.13", "eod": "212.0"}, "37509": {"serie": "67799.0", "versao": "91.13", "eod": "212.0"}, "37510": {"serie": "66840.0", "versao": "91.13", "eod": "212.0"}, "37513": {"serie": "67364.0", "versao": "91.13", "eod": "212.0"}, "37514": {"serie": "67850.0", "versao": "91.13", "eod": "212.0"}, "37515": {"serie": "67810.0", "versao": "91.13", "eod": "212.0"}, "37516": {"serie": "67079.0", "versao": "91.13", "eod": "212.0"}, "37518": {"serie": "67353.0", "versao": "91.13", "eod": "212.0"}, "37520": {"serie": "66648.0", "versao": "91.13", "eod": "212.0"}, "37522": {"serie": "66571.0", "versao": "91.13", "eod": "212.0"}, "37523": {"serie": "67198.0", "versao": "91.13", "eod": "212.0"}, "37524": {"serie": "67001.0", "versao": "91.13", "eod": "212.0"}, "39005": {"serie": "67758.0", "versao": "91.13", "eod": "212.0"}, "39011": {"serie": "67653.0", "versao": "91.13", "eod": "212.0"}, "39013": {"serie": "67745.0", "versao": "91.13", "eod": "212.0"}, "39018": {"serie": "67724.0", "versao": "91.13", "eod": "212.0"}, "39021": {"serie": "66229.0", "versao": "91.13", "eod": "212.0"}, "39031": {"serie": "66664.0", "versao": "91.13", "eod": "212.0"}, "39034": {"serie": "67040.0", "versao": "91.13", "eod": "212.0"}, "39036": {"serie": "67000.0", "versao": "91.13", "eod": "212.0"}, "39037": {"serie": "66837.0", "versao": "91.13", "eod": "212.0"}, "39038": {"serie": "67350.0", "versao": "91.13", "eod": "212.0"}, "39041": {"serie": "67728.0", "versao": "91.13", "eod": "212.0"}, "39049": {"serie": "67684.0", "versao": "91.13", "eod": "212.0"}, "39053": {"serie": "67803.0", "versao": "91.13", "eod": "212.0"}, "39054": {"serie": "66869.0", "versao": "91.13", "eod": "212.0"}, "39055": {"serie": "67733.0", "versao": "91.13", "eod": "212.0"}, "39059": {"serie": "67424.0", "versao": "91.13", "eod": "212.0"}, "39060": {"serie": "67234.0", "versao": "91.13", "eod": "212.0"}, "39062": {"serie": "67899.0", "versao": "91.13", "eod": "212.0"}, "39064": {"serie": "66960.0", "versao": "91.13", "eod": "212.0"}, "39066": {"serie": "67606.0", "versao": "91.13", "eod": "212.0"}, "39069": {"serie": "68308.0", "versao": "91.13", "eod": "212.0"}, "39072": {"serie": "67744.0", "versao": "91.13", "eod": "212.0"}, "39074": {"serie": "66815.0", "versao": "91.13", "eod": "212.0"}, "39081": {"serie": "67840.0", "versao": "91.13", "eod": "212.0"}, "39082": {"serie": "66152.0", "versao": "91.13", "eod": "212.0"}, "39083": {"serie": "66631.0", "versao": "91.13", "eod": "212.0"}, "39084": {"serie": "67230.0", "versao": "91.13", "eod": "212.0"}, "39086": {"serie": "66932.0", "versao": "91.13", "eod": "212.0"}, "39093": {"serie": "67048.0", "versao": "91.13", "eod": "212.0"}, "39094": {"serie": "67706.0", "versao": "91.13", "eod": "212.0"}, "39095": {"serie": "67091.0", "versao": "91.13", "eod": "212.0"}, "39116": {"serie": "66665.0", "versao": "91.13", "eod": "212.0"}, "39119": {"serie": "67716.0", "versao": "91.13", "eod": "212.0"}, "39121": {"serie": "66993.0", "versao": "91.13", "eod": "212.0"}, "39122": {"serie": "67394.0", "versao": "91.13", "eod": "212.0"}, "39126": {"serie": "68299.0", "versao": "91.13", "eod": "212.0"}, "39130": {"serie": "67894.0", "versao": "91.13", "eod": "212.0"}, "39131": {"serie": "68443.0", "versao": "91.13", "eod": "212.0"}, "39132": {"serie": "66379.0", "versao": "91.13", "eod": "212.0"}, "39133": {"serie": "67742.0", "versao": "91.13", "eod": "212.0"}, "39134": {"serie": "66273.0", "versao": "91.13", "eod": "212.0"}, "39136": {"serie": "67065.0", "versao": "91.13", "eod": "212.0"}, "39142": {"serie": "67702.0", "versao": "91.13", "eod": "212.0"}, "39501": {"serie": "67588.0", "versao": "91.13", "eod": "212.0"}, "39504": {"serie": "66717.0", "versao": "91.13", "eod": "212.0"}, "39507": {"serie": "66262.0", "versao": "91.13", "eod": "212.0"}, "39508": {"serie": "66868.0", "versao": "91.13", "eod": "212.0"}, "39510": {"serie": "67069.0", "versao": "91.13", "eod": "212.0"}, "39511": {"serie": "66450.0", "versao": "91.13", "eod": "212.0"}, "39514": {"serie": "67455.0", "versao": "91.13", "eod": "212.0"}, "39518": {"serie": "67819.0", "versao": "91.13", "eod": "212.0"}, "39531": {"serie": "67442.0", "versao": "91.13", "eod": "212.0"}, "39533": {"serie": "67629.0", "versao": "91.13", "eod": "212.0"}, "39537": {"serie": "67075.0", "versao": "91.13", "eod": "212.0"}, "39538": {"serie": "67120.0", "versao": "91.13", "eod": "212.0"}, "39540": {"serie": "68261.0", "versao": "91.13", "eod": "212.0"}, "39541": {"serie": "67956.0", "versao": "91.13", "eod": "212.0"}, "39546": {"serie": "67472.0", "versao": "91.13", "eod": "212.0"}, "39547": {"serie": "67447.0", "versao": "91.13", "eod": "212.0"}, "400109": {"serie": "67695.0", "versao": "91.13", "eod": "212.0"}, "400123": {"serie": "67011.0", "versao": "91.13", "eod": "212.0"}, "400124": {"serie": "67765.0", "versao": "91.13", "eod": "212.0"}, "400125": {"serie": "67650.0", "versao": "91.13", "eod": "212.0"}, "400129": {"serie": "66990.0", "versao": "91.13", "eod": "212.0"}, "400130": {"serie": "67642.0", "versao": "91.13", "eod": "212.0"}, "400131": {"serie": "66348.0", "versao": "91.13", "eod": "212.0"}, "400132": {"serie": "67814.0", "versao": "91.13", "eod": "212.0"}, "400134": {"serie": "66757.0", "versao": "91.13", "eod": "212.0"}, "400136": {"serie": "67319.0", "versao": "91.13", "eod": "212.0"}, "400137": {"serie": "66737.0", "versao": "91.13", "eod": "212.0"}, "400138": {"serie": "66786.0", "versao": "91.13", "eod": "212.0"}, "400139": {"serie": "67751.0", "versao": "91.13", "eod": "212.0"}, "400140": {"serie": "66103.0", "versao": "91.13", "eod": "212.0"}, "400141": {"serie": "68305.0", "versao": "91.13", "eod": "212.0"}, "400143": {"serie": "67571.0", "versao": "91.13", "eod": "212.0"}, "400144": {"serie": "67530.0", "versao": "91.13", "eod": "212.0"}, "400145": {"serie": "67900.0", "versao": "91.13", "eod": "212.0"}, "400147": {"serie": "67477.0", "versao": "91.13", "eod": "212.0"}, "400149": {"serie": "67066.0", "versao": "91.13", "eod": "212.0"}, "400167": {"serie": "66941.0", "versao": "91.13", "eod": "212.0"}, "400168": {"serie": "67658.0", "versao": "91.13", "eod": "212.0"}, "400169": {"serie": "67944.0", "versao": "91.13", "eod": "212.0"}, "400170": {"serie": "67061.0", "versao": "91.13", "eod": "212.0"}, "400171": {"serie": "66543.0", "versao": "91.13", "eod": "212.0"}, "400172": {"serie": "67964.0", "versao": "91.13", "eod": "212.0"}, "400176": {"serie": "68055.0", "versao": "91.13", "eod": "212.0"}, "400189": {"serie": "66962.0", "versao": "91.13", "eod": "212.0"}, "400196": {"serie": "67567.0", "versao": "91.13", "eod": "212.0"}, "400197": {"serie": "66733.0", "versao": "91.13", "eod": "212.0"}, "400198": {"serie": "67517.0", "versao": "91.13", "eod": "212.0"}, "400205": {"serie": "66128.0", "versao": "91.13", "eod": "212.0"}, "400206": {"serie": "67268.0", "versao": "91.13", "eod": "212.0"}, "400207": {"serie": "67683.0", "versao": "91.13", "eod": "212.0"}, "400208": {"serie": "67730.0", "versao": "91.13", "eod": "212.0"}, "400209": {"serie": "66139.0", "versao": "91.13", "eod": "212.0"}, "400218": {"serie": "67834.0", "versao": "91.13", "eod": "212.0"}};
    // Estrutura: { "YYYY-MM-DD": { "PREFIXO": "HH:MM", ... } }
    const HISTORICO = {"2025-12-08": {"39081": "23:59", "39093": "23:59", "39541": "23:58", "39122": "23:57", "37520": "23:57", "39083": "23:56", "400130": "23:56", "37522": "23:55", "37518": "23:55", "39005": "23:55", "37502": "23:55", "39537": "23:53", "39119": "23:53", "37516": "23:52", "400125": "23:52", "400167": "23:51", "37509": "23:51", "400169": "23:51", "39538": "23:51", "39082": "23:50", "400124": "23:50", "39013": "23:50", "39540": "23:50", "39054": "23:50", "37505": "23:50", "400144": "23:49", "39507": "23:49", "39131": "23:48", "400136": "23:48", "400145": "23:48", "39060": "23:48", "37506": "23:48", "37510": "23:48", "400139": "23:48", "39062": "23:47", "400168": "23:47", "39041": "23:47", "400197": "23:47", "37515": "23:47", "400137": "23:46", "39547": "23:46", "400129": "23:45", "39084": "23:45", "400172": "23:44", "39546": "23:43", "39011": "23:43", "400134": "23:42", "400147": "23:41", "39501": "23:41", "400218": "23:41", "39018": "23:41", "400140": "23:41", "39049": "23:41", "39508": "23:40", "400189": "23:40", "39037": "23:39", "400138": "23:39", "39059": "23:39", "39094": "23:38", "37507": "23:38", "39518": "23:38", "39064": "23:37", "400149": "23:37", "400176": "23:37", "39533": "23:37", "39132": "23:36", "37524": "23:36", "39055": "23:36", "400170": "23:36", "400171": "23:35", "39095": "23:35", "39514": "23:35", "39136": "23:34", "39086": "23:34", "400143": "23:34", "39126": "23:34", "400123": "23:33", "39072": "23:33", "37523": "23:32", "37504": "23:32", "39031": "23:32", "39053": "23:32", "39142": "23:31", "39021": "23:31", "39133": "23:31", "39511": "23:30", "39121": "23:30", "400131": "23:30", "39069": "23:30", "37513": "23:30", "37508": "23:30", "400196": "23:30", "400132": "23:27", "400141": "21:51", "39542": "13:50", "39539": "12:36", "400209": "10:39", "400207": "10:39", "400206": "10:23", "400205": "10:22", "400208": "10:19", "400109": "08:37", "37514": "05:53", "39074": "05:49", "39046": "05:33", "39096": "04:47", "37529": "04:43", "400198": "04:26", "39139": "04:18"}, "2025-12-09": {"400218": "23:59", "37507": "23:59", "39037": "23:59", "39514": "23:59", "400197": "23:59", "400172": "23:58", "39531": "23:58", "400125": "23:58", "400139": "23:57", "39533": "23:57", "39126": "23:56", "39518": "23:56", "39537": "23:56", "39095": "23:56", "400131": "23:55", "39034": "23:55", "400145": "23:54", "39507": "23:54", "400149": "23:54", "39005": "23:53", "400130": "23:52", "400206": "23:52", "37513": "23:52", "37523": "23:51", "400134": "23:51", "37502": "23:51", "39049": "23:51", "39130": "23:51", "37520": "23:50", "400171": "23:50", "39119": "23:50", "39069": "23:49", "400176": "23:48", "39546": "23:48", "400143": "23:48", "400136": "23:48", "39093": "23:47", "400198": "23:46", "39547": "23:46", "39031": "23:46", "39081": "23:45", "37522": "23:44", "400132": "23:44", "400123": "23:44", "39121": "23:43", "39501": "23:43", "39021": "23:43", "400138": "23:42", "37516": "23:42", "39072": "23:42", "37509": "23:42", "400124": "23:41", "400209": "23:40", "400196": "23:40", "39054": "23:40", "400208": "23:39", "37510": "23:39", "37524": "23:38", "39538": "23:38", "400170": "23:38", "39013": "23:37", "37504": "23:37", "39082": "23:37", "400207": "23:36", "39055": "23:35", "37506": "23:35", "400205": "23:35", "39062": "23:35", "39083": "23:34", "400144": "23:34", "400140": "23:32", "400137": "23:32", "39059": "23:32", "39011": "23:32", "400167": "23:32", "37515": "23:32", "39508": "23:32", "400189": "23:31", "39074": "23:31", "37508": "23:31", "39116": "23:30", "400147": "23:30", "39136": "23:30", "400168": "23:30", "37505": "23:30", "39086": "23:29", "400109": "23:28", "39142": "21:48", "400141": "19:19", "39084": "18:23", "39053": "17:14", "39132": "14:15", "39122": "11:02", "39066": "08:52", "39041": "07:43", "39094": "06:42", "400129": "05:47", "39038": "05:32", "39540": "05:23", "39131": "05:11", "39133": "04:55", "400169": "04:55", "39018": "04:43", "37514": "04:31", "37518": "04:27", "39060": "04:19", "39511": "04:08", "39541": "04:00", "39064": "03:40"}, "2025-12-10": {"400207": "10:34", "400140": "10:33", "39537": "10:30", "37502": "10:30", "39034": "10:30", "39508": "10:28", "39031": "10:28", "39121": "10:27", "39049": "10:26", "37523": "10:25", "39531": "10:25", "400198": "10:21", "400206": "10:20", "400109": "10:20", "39142": "10:19", "400205": "10:19", "400208": "10:15", "400136": "10:14", "400149": "10:13", "39036": "10:10", "400209": "10:09", "400197": "10:07", "400147": "10:05", "39074": "09:55", "400196": "09:46", "37503": "09:09", "400139": "08:35", "39083": "06:39", "400123": "06:17", "39510": "06:08", "37505": "05:50", "39081": "05:48", "39054": "05:48", "400134": "05:46", "400218": "05:45", "400170": "05:41", "400189": "05:38", "400141": "05:36", "39011": "05:35", "400172": "05:31", "39514": "05:31", "400145": "05:28", "37520": "05:23", "400171": "05:22", "39119": "05:22", "37509": "05:21", "39093": "05:21", "400129": "05:21", "39501": "05:17", "400132": "05:17", "37522": "05:17", "39072": "05:15", "39122": "05:10", "39131": "05:10", "39062": "05:09", "39055": "05:08", "39507": "05:06", "39134": "05:05", "39136": "05:04", "39086": "05:02", "400176": "05:00", "400125": "05:00", "400130": "04:56", "39518": "04:54", "37513": "04:54", "39547": "04:48", "400138": "04:45", "37516": "04:44", "400124": "04:44", "400169": "04:43", "37510": "04:41", "39538": "04:40", "37504": "04:40", "39013": "04:39", "39082": "04:39", "39059": "04:38", "400168": "04:37", "400144": "04:36", "400137": "04:35", "400167": "04:35", "39116": "04:33", "37508": "04:33", "37507": "04:33", "39037": "04:31", "37518": "04:30", "39533": "04:29", "39064": "04:15", "37524": "04:11", "37506": "04:08", "39060": "04:07", "37515": "04:06", "37514": "04:06", "39095": "03:58", "39130": "03:54", "39069": "03:52", "400143": "03:51", "39021": "03:46", "400131": "03:40", "39126": "03:29", "39005": "03:26", "39546": "03:20", "39504": "03:09"}};

    const datePicker = document.getElementById('datePicker');

    function init() {
        datePicker.addEventListener('change', () => renderDashboard());
        renderDashboard(); // Render inicial
    }

    function changeDate(days) {
        const currentDate = new Date(datePicker.value + 'T00:00:00'); // T00:00 fixa fuso
        currentDate.setDate(currentDate.getDate() + days);
        datePicker.value = currentDate.toISOString().split('T')[0];
        renderDashboard();
    }

    function renderDashboard() {
        const selectedDate = datePicker.value;
        const dadosDia = HISTORICO[selectedDate] || {};
        
        let onlineCount = 0;
        let offlineCount = 0;
        
        const listInativos = document.getElementById('lista-inativos');
        const listAtivos = document.getElementById('lista-ativos');
        
        listInativos.innerHTML = '';
        listAtivos.innerHTML = '';

        // Processar Frota
        FROTA.forEach(veiculo => {
            const horaComunicacao = dadosDia[veiculo]; // undefined se n√£o comunicou

            if (horaComunicacao) {
                // --- ATIVO ---
                onlineCount++;
                const card = document.createElement('div');
                card.className = 'vehicle-card';
                card.onclick = () => showDetails(veiculo, selectedDate, horaComunicacao);
                card.innerHTML = `
                    <span class="v-prefix">${veiculo}</span>
                    <span class="v-time">üïí ${horaComunicacao}</span>
                `;
                listAtivos.appendChild(card);
            } else {
                // --- INATIVO ---
                offlineCount++;
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><span class="status-badge bg-danger">OFFLINE</span></td>
                    <td><strong>${veiculo}</strong></td>
                    <td>-</td>
                    <td><a href="#" style="color: var(--accent)" onclick="showDetails('${veiculo}', '${selectedDate}', null)">Ver Ficha</a></td>
                `;
                listInativos.appendChild(row);
            }
        });

        // Atualizar KPIs
        document.getElementById('kpi-online').innerText = onlineCount;
        document.getElementById('kpi-offline').innerText = offlineCount;
        document.getElementById('kpi-total').innerText = FROTA.length;
        
        // Atualizar Contadores de Aba
        document.getElementById('count-inativos').innerText = offlineCount;
        document.getElementById('count-ativos').innerText = onlineCount;

        // Empty States
        document.getElementById('empty-inativos').style.display = offlineCount === 0 ? 'block' : 'none';
        document.getElementById('empty-ativos').style.display = onlineCount === 0 ? 'block' : 'none';
    }

    // --- L√≥gica de Abas ---
    function switchTab(tabId) {
        document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
        
        document.getElementById(tabId).classList.add('active');
        // Acha o bot√£o correspondente (simplificado)
        const btns = document.querySelectorAll('.tab-btn');
        if(tabId === 'inativos') btns[0].classList.add('active');
        else btns[1].classList.add('active');
    }

    // --- Modal ---
    const modal = document.getElementById('modalInfo');
    function showDetails(veiculo, data, hora) {
        const meta = METADATA[veiculo] || {};
        document.getElementById('modalTitle').innerText = `Ve√≠culo ${veiculo}`;
        document.getElementById('modalBody').innerHTML = `
            <p><strong>üìÖ Data Selecionada:</strong> <span>${data.split('-').reverse().join('/')}</span></p>
            <p><strong>üì° Status no dia:</strong> <span style="color:${hora ? 'green':'red'}">${hora ? 'Online √†s ' + hora : 'Offline'}</span></p>
            <hr>
            <p><strong>üî¢ S√©rie:</strong> <span>${meta.serie}</span></p>
            <p><strong>üíæ Vers√£o:</strong> <span>${meta.versao}</span></p>
            <p><strong>‚öôÔ∏è EOD:</strong> <span>${meta.eod}</span></p>
        `;
        modal.style.display = "block";
    }
    function closeModal() { modal.style.display = "none"; }
    window.onclick = function(event) { if (event.target == modal) closeModal(); }

    // Iniciar
    init();
</script>
</body>
</html>